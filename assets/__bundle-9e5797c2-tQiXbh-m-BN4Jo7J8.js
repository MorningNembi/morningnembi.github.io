import{j as b,Z as a,w as x,y as q,t as R,a as S,H as j,c as L}from"./index-DMWlIAgL.js";var N=function(i,o){return new Promise((function(v,s){if(typeof XMLHttpRequest<"u"){var d=b.of(i),n=d.dispatcher,w=d.logger,u=o.requestId,H=o.method,y=o.url,c=o.headers,p=c===void 0?{}:c,f=o.data,E=f===void 0?"":f,l=o.uploadProgressHandler,g=!1,e=new XMLHttpRequest;e.open(H,y),Object.keys(p).forEach((function(t){e.setRequestHeader(t,p[t])})),l&&e.upload.addEventListener("progress",(function(t){t.lengthComputable?l(u,t.loaded,t.total):w.debug("Progress computing failed: `Content-Length` header is not given.")})),e.onabort=function(){s(a.requestCanceled)},e.onerror=function(t){s(a.networkError)},e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&!g)if(e.status===0||e.status>=200&&e.status<400)try{var t=JSON.parse(e.responseText);v(new x(i,t))}catch{s(a.networkError)}else try{var h=JSON.parse(e.responseText);if(h){var r=new a(h);if(r.isSessionExpiredError){if(n.dispatch(new q({reason:r.code,message:r.message})),!(e instanceof R)){var m=new S;return n.dispatch(new j({request:e,deferred:m,error:r})),m.promise}}else r.isSessionInvalidatedError&&n.dispatch(new q({reason:r.code,message:r.message}));s(r)}else s(a.requestFailed)}catch{s(a.requestFailed)}},n.on((function(t){t instanceof L&&(t.requestId&&t.requestId!==u||(g=!0,e.abort()))})),e.send(E)}else s(a.xmlHttpRequestNotSupported)}))};export{N as xmlHttpRequest};
