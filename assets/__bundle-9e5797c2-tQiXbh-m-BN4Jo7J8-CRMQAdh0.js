import{W as R,X as a,S as x,_ as m,$ as y,z as b,H as L,l as N}from"./index-ldtZWZkA.js";var O=function(i,n){return new Promise((function(v,r){if(typeof XMLHttpRequest<"u"){var d=R.of(i),o=d.dispatcher,w=d.logger,u=n.requestId,H=n.method,E=n.url,p=n.headers,c=p===void 0?{}:p,f=n.data,S=f===void 0?"":f,l=n.uploadProgressHandler,g=!1,e=new XMLHttpRequest;e.open(H,E),Object.keys(c).forEach((function(t){e.setRequestHeader(t,c[t])})),l&&e.upload.addEventListener("progress",(function(t){t.lengthComputable?l(u,t.loaded,t.total):w.debug("Progress computing failed: `Content-Length` header is not given.")})),e.onabort=function(){r(a.requestCanceled)},e.onerror=function(t){r(a.networkError)},e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&!g)if(e.status===0||e.status>=200&&e.status<400)try{var t=JSON.parse(e.responseText);v(new x(i,t))}catch{r(a.networkError)}else try{var q=JSON.parse(e.responseText);if(q){var s=new a(q);if(s.isSessionExpiredError){if(o.dispatch(new m({reason:s.code,message:s.message})),!(e instanceof y)){var h=new b;return o.dispatch(new L({request:e,deferred:h,error:s})),h.promise}}else s.isSessionInvalidatedError&&o.dispatch(new m({reason:s.code,message:s.message}));r(s)}else r(a.requestFailed)}catch{r(a.requestFailed)}},o.on((function(t){t instanceof N&&(t.requestId&&t.requestId!==u||(g=!0,e.abort()))})),e.send(S)}else r(a.xmlHttpRequestNotSupported)}))};export{O as xmlHttpRequest};
